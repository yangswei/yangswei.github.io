---
layout: post
title: "Redis集群下的那些事"
date: 2018-12-18  
description: "linux redis cluster"
tag: Linux
---  

> 背景：近期弄了一套集群环境的服务，其中包含mongo数据库集群，redis集群和其他的服务集群，高可用的架构，为了支持真正意义的高可用，而做了这篇博客的操作，这里不是介绍怎么搭建redis高可用集群，而是如何将redis的高可用应用到服务中

redis集群模式-'redis中文社区搭建方法'

### 启动redis

**redis.conf**redis实例的配置文件，实例配置包含监听端口，ip等等信息，如下是最小的集群redis.conf
cluster-enabled指定启动集群模式
cluster-config-file指定保存节点配置的文件，redis集群启动后会自动创建修改维护这些nodes.conf文件

redis集群最少三个节点

```
port 7000
cluster-enabled yes
cluster-config-file nodes.conf
cluster-node-timeout 5000
appendonly yes
```

从官网下载最新redis编译后，即得到可执行文件redis-server
运行节点也很简单 **../redis-server xxx/redis.conf**

### 组建集群

按上面方法，通过修改监听端口启动的不同节点的redis实例，但还不是集群
'redis-trib 位于Redis源码的src文件夹中,它是一个Ruby程序'

```
./redis-trib.rb create --replicas 1  ip1:port1 ip2:port2 ip3:port3 ip4:port4 ip5:port5 ip6:port6
```

**--replicas 1** 指定在6个节点中为每个主节点创建一个从，则执行完后会生成对应的三主三从节点配置。
完成集群，是不是很简单
